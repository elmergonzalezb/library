---
# Common tasks for Debian-dervived operating systems.

- name: Uninstall unnecessary packages.
  when: uninstall_unnecessary_packages is defined and
        uninstall_unnecessary_packages
  block:
    - name: Remove packages.
      apt:
        name: "{{ unnecessary_packages.common | default([]) + unnecessary_packages.debian | default([]) }}"
        state: absent
        autoremove: true
        purge: true

    - name: Upgrade remaining packages.
      apt:
        force_apt_get: true
        update_cache: true
        upgrade: true
        autoremove: true

- name: Check for Raspbian OS.
  register: rpi_issue
  stat:
    path: /etc/rpi-issue
    get_checksum: false

- name: Set Raspbian fact.
  set_fact:
    raspbian: true
  when: rpi_issue.stat.exists

- name: Include Raspbian-specific tasks.
  when: raspbian is defined and raspbian
  include_tasks: "common-raspbian.yml"
